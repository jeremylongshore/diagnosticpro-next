{"version":3,"file":"_server-CStNPDsI.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/create-checkout-session/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport Stripe from \"stripe\";\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY || \"sk_test_your_secret_key_here\", {\n  apiVersion: \"2023-10-16\"\n});\nasync function POST({ request, url }) {\n  try {\n    console.log(\"üõí Creating Stripe checkout session...\");\n    const { priceId, serviceType, customerInfo, diagnosticData } = await request.json();\n    const servicePrices = {\n      \"diagnosis\": { amount: 499, name: \"Equipment Diagnosis\" },\n      // $4.99\n      \"verification\": { amount: 499, name: \"Quote Verification\" },\n      // $4.99\n      \"emergency\": { amount: 799, name: \"EMERGENCY Diagnosis\" }\n      // $7.99\n    };\n    const selectedService = servicePrices[serviceType] || servicePrices.diagnosis;\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: [\"card\"],\n      mode: \"payment\",\n      line_items: [\n        {\n          price_data: {\n            currency: \"usd\",\n            product_data: {\n              name: `DiagnosticPro ${selectedService.name}`,\n              description: `Expert AI diagnosis for ${diagnosticData?.equipmentType || \"your equipment\"}`,\n              images: [\"https://diagnosticpro.io/logo.png\"]\n              // Add your logo URL\n            },\n            unit_amount: selectedService.amount\n          },\n          quantity: 1\n        }\n      ],\n      customer_email: customerInfo?.email,\n      metadata: {\n        serviceType,\n        customerName: customerInfo?.name || \"Unknown\",\n        customerEmail: customerInfo?.email || \"\",\n        customerPhone: customerInfo?.phone || \"\",\n        equipmentType: diagnosticData?.equipmentType || \"Unknown\",\n        make: diagnosticData?.make || \"\",\n        model: diagnosticData?.model || \"\",\n        year: diagnosticData?.year || \"\",\n        problemDescription: diagnosticData?.problemDescription || \"\",\n        errorCodes: diagnosticData?.errorCodes || \"\",\n        shopQuote: diagnosticData?.shopQuote || \"\",\n        timestamp: (/* @__PURE__ */ new Date()).toISOString(),\n        source: \"diagnosticpro-mvp\"\n      },\n      success_url: `${url.origin}/payment-success?session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${url.origin}/?payment=cancelled`,\n      allow_promotion_codes: true,\n      billing_address_collection: \"auto\",\n      shipping_address_collection: {\n        allowed_countries: [\"US\", \"CA\"]\n      }\n    });\n    console.log(`‚úÖ Checkout session created: ${session.id}`);\n    return json({\n      success: true,\n      sessionId: session.id,\n      url: session.url\n    });\n  } catch (error) {\n    console.error(\"‚ùå Failed to create checkout session:\", error);\n    return json(\n      {\n        success: false,\n        error: \"Failed to create checkout session. Please try again.\",\n        details: error.message\n      },\n      { status: 500 }\n    );\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}