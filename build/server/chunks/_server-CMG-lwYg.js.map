{"version":3,"file":"_server-CMG-lwYg.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/submit-diagnosis/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { A as AIAnalysisService, E as EmailService } from \"../../../../chunks/emailService.js\";\nasync function POST({ request }) {\n  try {\n    console.log(\"üìù New diagnostic form submission received\");\n    const formData = await request.json();\n    if (!formData.problemDescription || !formData.email || !formData.fullName) {\n      return json(\n        { success: false, error: \"Missing required fields\" },\n        { status: 400 }\n      );\n    }\n    console.log(`üîç Processing ${formData.selectedService} request for ${formData.fullName}`);\n    console.log(\"üìß Skipping admin notification to prioritize AI analysis\");\n    let analysisResult;\n    if (formData.selectedService === \"emergency\") {\n      analysisResult = await AIAnalysisService.performEmergencyTriage(formData);\n      console.log(\"‚ö° Emergency analysis completed\");\n    } else {\n      analysisResult = await AIAnalysisService.analyzeDiagnosticRequest(formData);\n      console.log(\"üéØ Full diagnostic analysis completed\");\n    }\n    const reportData = {\n      equipmentType: formData.equipmentType || \"Equipment\",\n      make: formData.make || \"Unknown\",\n      model: formData.model || \"Unknown\",\n      year: formData.year,\n      problemDescription: formData.problemDescription,\n      errorCodes: formData.errorCodes,\n      selectedService: formData.selectedService,\n      ...analysisResult\n    };\n    try {\n      await EmailService.sendDiagnosticReport(\n        reportData,\n        formData.email,\n        formData.fullName\n      );\n      console.log(\"‚úÖ Diagnostic report sent to customer\");\n    } catch (emailError) {\n      console.error(\"‚ùå Failed to send customer email:\", emailError);\n      return json({\n        success: true,\n        message: \"Analysis completed but email delivery failed. Please contact support.\",\n        analysis: analysisResult,\n        emailDelivered: false\n      });\n    }\n    console.log(`‚úÖ ${formData.selectedService} request completed successfully for ${formData.email}`);\n    return json({\n      success: true,\n      message: \"Diagnostic analysis completed! Check your email for the detailed report.\",\n      analysisPreview: {\n        diagnosis: analysisResult.diagnosis,\n        urgencyLevel: analysisResult.urgencyLevel,\n        estimatedCost: analysisResult.estimatedCosts?.total || analysisResult.estimatedCost\n      },\n      emailDelivered: true\n    });\n  } catch (error) {\n    console.error(\"‚ùå Diagnostic submission failed:\", error);\n    return json(\n      {\n        success: false,\n        error: \"Analysis failed. Please try again or contact support.\",\n        details: error.message\n      },\n      { status: 500 }\n    );\n  }\n}\nasync function OPTIONS() {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type\"\n    }\n  });\n}\nexport {\n  OPTIONS,\n  POST\n};\n"],"names":["AIAnalysisService","EmailService"],"mappings":"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"}